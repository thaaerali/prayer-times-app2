class NahjAlBalagha {
  constructor() {
    this.baseURL = 'https://raw.githubusercontent.com/thaaerali/nahj-data/main/data.json';
    this.currentPage = 1;
    this.itemsPerPage = 10;
    this.currentCategory = 'all';
    this.currentSearch = '';
    this.data = [];
    this.pageLoaded = false;
    this.elements = null;
    
    console.log('تهيئة نهج البلاغة...');
    
    // تأجيل init حتى يتم تحميل DOM
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => this.init());
    } else {
      this.init();
    }
  }

  async init() {
    console.log('بدء init...');
    
    try {
      // تحميل الصفحة
      await this.ensurePageLoaded();
      
      // تحميل البيانات
      await this.loadData();
      
      // عرض المحتوى
      this.renderContent();
      
      console.log('تهيئة نهج البلاغة مكتملة');
    } catch (error) {
      console.error('خطأ في تهيئة نهج البلاغة:', error);
    }
  }

  async ensurePageLoaded() {
    if (this.pageLoaded) return;
    
    console.log('تأكد من تحميل الصفحة...');
    
    // أولاً، تحقق مما إذا كانت الصفحة موجودة بالفعل في DOM
    let nahjPage = document.getElementById('nahj-page');
    
    if (!nahjPage) {
      console.log('الصفحة غير موجودة، جاري إنشاؤها...');
      // إنشاء الصفحة ديناميكياً
      nahjPage = this.createPage();
      document.body.appendChild(nahjPage);
    }
    
    // حفظ العناصر
    this.elements = {
      nahjPage: document.getElementById('nahj-page'),
      nahjContent: document.getElementById('nahj-content'),
      nahjSearch: document.getElementById('nahj-search'),
      nahjSearchBtn: document.getElementById('nahj-search-btn'),
      nahjCategory: document.getElementById('nahj-category'),
      nahjPagination: document.getElementById('nahj-pagination'),
      nahjBackButton: document.getElementById('nahj-back-button')
    };
    
    console.log('العناصر المحفوظة:', this.elements);
    
    // إضافة الأحداث
    this.addEventListeners();
    
    this.pageLoaded = true;
  }

  createPage() {
    console.log('إنشاء صفحة نهج البلاغة ديناميكياً...');
    
    const page = document.createElement('div');
    page.id = 'nahj-page';
    page.className = 'page';
    page.innerHTML = `
      <!-- رأس صفحة نهج البلاغة -->
      <header class="bg-primary text-white text-center p-3 shadow-sm d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <button id="nahj-back-button" class="btn btn-light">
            <i class="bi bi-arrow-right"></i>
          </button>
          <h1 class="h4 mb-0">نهج البلاغة</h1>
        </div>
      </header>

      <!-- محتوى نهج البلاغة -->
      <div class="container my-4">
        <!-- فلتر البحث -->
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="input-group">
              <input type="text" id="nahj-search" class="form-control" placeholder="ابحث في نهج البلاغة...">
              <button class="btn btn-outline-primary" type="button" id="nahj-search-btn">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>
          <div class="col-md-6">
            <select id="nahj-category" class="form-select">
              <option value="all">جميع الأقسام</option>
              <option value="sermons">الخطب</option>
              <option value="letters">الرسائل</option>
              <option value="wisdom">الحكم</option>
            </select>
          </div>
        </div>

        <!-- عرض المحتوى -->
        <div id="nahj-content" class="nahj-content">
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">جاري التحميل...</span>
            </div>
            <p class="mt-3">جاري تحميل محتويات نهج البلاغة...</p>
          </div>
        </div>

        <!-- الترقيم -->
        <nav aria-label="تصفح نهج البلاغة" class="mt-4">
          <ul class="pagination justify-content-center" id="nahj-pagination"></ul>
        </nav>
      </div>
    `;
    
    return page;
  }

  addEventListeners() {
    console.log('إضافة الأحداث...');
    
    // العودة من صفحة نهج البلاغة
    if (this.elements.nahjBackButton) {
      this.elements.nahjBackButton.addEventListener('click', () => {
        this.showHomePage();
      });
      console.log('تمت إضافة حدث العودة');
    }

    // البحث
    if (this.elements.nahjSearchBtn) {
      this.elements.nahjSearchBtn.addEventListener('click', () => {
        this.searchContent();
      });
    }

    if (this.elements.nahjSearch) {
      this.elements.nahjSearch.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          this.searchContent();
        }
      });
    }

    // تصفية حسب الفئة
    if (this.elements.nahjCategory) {
      this.elements.nahjCategory.addEventListener('change', (e) => {
        this.currentCategory = e.target.value;
        this.currentPage = 1;
        this.renderContent();
      });
    }
  }

  async loadData() {
    console.log('جاري تحميل البيانات...');
    
    try {
      const url = 'https://raw.githubusercontent.com/thaaerali/nahj-data/main/data.json';
      console.log('الرابط:', url);
      
      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error(`فشل HTTP: ${response.status} ${response.statusText}`);
      }
      
      const text = await response.text();
      console.log('البيانات الخام (أول 500 حرف):', text.substring(0, 500));
      
      // محاولة تحليل JSON
      let data;
      try {
        data = JSON.parse(text);
      } catch (parseError) {
        console.error('خطأ في تحليل JSON:', parseError);
        throw new Error('تنسيق JSON غير صالح في الملف');
      }
      
      if (!Array.isArray(data)) {
        throw new Error('البيانات يجب أن تكون مصفوفة');
      }
      
      this.data = data;
      console.log(`تم تحميل ${data.length} عنصر بنجاح`);
      
    } catch (error) {
      console.error('خطأ في تحميل البيانات من GitHub:', error);
      
      // استخدام بيانات تجريبية
      this.loadSampleData();
    }
  }

  loadSampleData() {
    console.log('جاري تحميل بيانات تجريبية...');
    
    this.data = [
      {
        "id": 1,
        "title": "فمن خطبة له عليه السّلام
يذكر فيها ابتداء خلق السماء والأرض  وخلق آدم وفيها ذكر الحج
",
        "content": "الحمد للّه الّذى لا يبلغ مدحته القائلون ، ولا يحصى نعماءه العادّون ، ولا يؤدّى حقّه المجتهدون ، الّذى لا يدركه بعد الهمم (1) ولا يناله غوص الفطن (2) الّذى ليس لصفته حدّ محدود (3) ولا نعت موجود ، ولا وقت معدود ، ولا أجل ممدود : فطر الخلائق بقدرته ، ونشر الرّياح برحمته ، ووتّد بالصّخور ميدان أرضه (4) أوّل الدّين معرفته (5) وكمال معرفته التّصديق به ، وكمال
__________________
(1) أى. أن همم النظار وأصحاب الفكر ، وإن علت وبعدت ، فانها لا تدركه تعالى ولا تحيط به علما.
(2) والفطن : جمع فطنة ، وغوصها : استغراقها فى بحر المعقولات لتلتقط درر الحقيقة وهى وإن بعدت فى الغوص لا تنال حقيقة الذات الأقدس.
(3) فرغ من الكلام فى الذات وامتناعها على العقول إدراكا ، ثم هو الآن فى تقديس صفاته عن مشابهة الصفات الحادثة ، فكل صفات الممكن لها فى أثرها حد تنقطع إليه ، كما نجده فى قدرتنا وعلمنا مثلا ، فان لكل طورا لا يتعداه. أما قدرة اللّه وعلمه فلا حد لشمولهما ، وكذا يقال فى باقى الصفات الكمالية. والنعت يقال لما يتغير ، وصفاتنا لها نعوت ، فحياتنا مثلا لها أطوار : من طفولية ، وصبا ، وما بعدهما ، وقوة ، وضعف ، وتوسط ، وقدرتنا كذلك. وعلمنا له أدوار نقص وكمال ، وغموض ووضوح. أما صفاته تعالى فهى منزهة عن هذه النعوت وأشباهها. ثم هى أزلية أبدية ، لا تعد الأوقات لوجودها واتصاف ذاته بها ، ولا تضرب لها الآجال
(4) الميدان : الحركة ، ووتد بالتخفيف والتشديد أى : ثبت ، أى : سكن الأرض بعد اضطرابها بما رسخ من الصخور الجامدة فى أديمها ، وهو يشير إلى أن الأرض كانت مائدة مضطربة قبل جمودها
(5) أساس الدين معرفة اللّه ، وهو قد يعرف بأنه صانع العالم ، وليس منه
 
التّصديق به توحيده ، وكمال توحيده الإخلاص له ، وكمال الإخلاص له نفى الصّفات عنه ، لشهادة كلّ صفة أنّها غير الموصوف ، وشهادة كلّ موصوف أنّه غير الصّفة : فمن وصف اللّه سبحانه فقد قرنه ، ومن قرنه فقد ثنّاه ، ومن ثنّاه فقد جزّأه ، ومن جزّأه فقد جهله (1) ومن جهله فقد أشار إليه ، ومن أشار إليه فقد حدّه (2) ، ومن حدّه فقد عدّه ، ومن قال «فيم؟» فقد ضمّنه ،
__________________
، بدون تنزيه ، وهى معرفة ناقصة ، وكمالها التصديق به ذاته : بصفته الخاصة التى لا يشركه فيها غيره ، وهى وجوب الوجود ، ولا يكمل هذا التصديق حتى يكون معه لازمه وهو التوحيد ، لأن الواجب لا يتعدد كما عرف فى فن الالهيات والكلام ولا يكمل التوحيد إلا بتمحيض السر له دون ملامحة لشىء من شؤون الحوادث فى التوجه إليه واستشراق نوره. ولا يكون هذا الاخلاص كاملا حتى يكون معه نفى الصفات الظاهرة فى التعينات المشهودة فى المشخصات ، لأن معرفة الذات الأقدس فى نحو تلك الصفات اعتبار للذات ولشىء آخر مغاير لها معها ، فيكون قد عرف مسمى اللّه مؤلفا لا متوحدا ، فالصفات المنفية بالاخلاص صفات المصنوعين ، وإلا فللامام على كلام قد ملئ بصفاته سبحانه ، بل هو فى هذا الكلام يصفه أكمل الوصف
(1) جهله : أى : جهل أنه منزه عن مشابهة الماديات ، مقدس عن مضارعة المركبات ، وهذا الجهل يستلزم القول بالشخص الجسمانى ، وهو يستلزم صحة الاشارة إليه ، تعالى اللّه عن ذلك.
(2) إنما تشير إلى شىء إذا كان منك فى جهة ، فأنت تتوجه إليها باشارتك وما كان فى جهة فهو منقطع عن غيرها ، فيكون محدودا ـ أى : له طرف ينتهى إليه ـ فمن أشار إليه فقد حده ، ومن حد فقد عد ـ أى : أحصى وأحاط بذلك المحدود ـ لأن الحد حاصر لمحدوده. وإذا قلت لشىء «فيم هو» فقد جعلته فى ضمن شىء ، ثم تسأل عن تعيين ذلك الذى تضمنه. وإذا قلت «على أى شىء» فأنت ترى انه مستعل على شىء بعينه وما عداه خال منه
 
ومن قال «علام؟» فقد أخلى منه. كائن لا عن حدث (1) موجود لا عن عدم ، مع كلّ شىء لا بمقارنة ، وغير كلّ شىء لا بمزايلة (2) فاعل لا بمعنى الحركات والآلة ، بصير إذ لا منظور إليه من خلقه (3) متوحّد إذ لا سكن يستأنس به ولا يستوحش لفقده (4) أنشأ الخلق إنشاء ، وابتدأه ابتداء ، بلا رويّة أجالها (5) ولا تجربة استفادها ، ولا حركة أحدثها ، ولا همامة نفس اضطرب فيها (6) أحال الأشياء لأوقاتها (7) ولأم بين مختلفاتها (8) وغرّز
__________________
(1) الحدث : الابداء ، أى : هو موجود لكن لا عن إبداء وإيجاد موجد. والفقرة الثانية لازمة لهذه ، لأنه إن لم يكن وجوده عن إيجاد موجد فهو غير مسبوق الوجود بالعدم.
(2) المزايلة : المفارقة والمباينة.
(3) أى : بصير بخلقه قبل وجودهم.
(4) العادة والعرف على انه لا يقال «متوحد» إلا لمن كان له من يستأنس بقربه ويستوحش لبعده ، فانفرد عنه. واللّه متوحد مع التنزه عن السكن.
(5) الروية : الفكر ، وأجالها : أدارها ورددها. وفى نسخة : أحالها ـ بالمهملة ـ أي : صرفها.
(6) همامة النفس ـ بفتح الهاء ـ : اهتمامها بالأمر ، وقصدها إليه.
(7) حولها من العدم إلى الوجود فى أوقاتها ، أو هو من «حال فى متن فرسه» أى : وثب. وأحاله غيره : أوثبه. ومن أقر الأشياء فى أحيانها صار كمن أحال غيره على فرسه.
(8) كما قرن النفس الروحانية بالجسد المادى
 
غرائزها (1) وألزمها أشباحها (2) عالما بها قبل ابتدائها ، محيطا بحدودها وانتهائها عارفا بقرائنها وأحنائها (3) ثمّ أنشأ سبحانه فتق الأجواء (4) وشقّ الأرجاء ، وسكائك الهواء (5) فأجرى فيها ماء متلاطما تيّاره (6) متراكما زخّاره. حمله
__________________
(1) الغرائز : جمع غريزة ، وهى : الطبيعة وغرز الغرائز كضوأ الأضواء ، أى : جعلها غرائز ، والمراد أودع فيها طبائعها.
(2) الضمير فى «أشباحها» للغرائز ، أى : ألزم الغرائز أشباحها ، أى : أشخاصها لأن كل مطبوع على غريزة فانها تلازمه : فالشجاع لا يكون خوارا مثلا.
(3) جمع حنو بالكسر ، أى : الجانب. أو ما اعوج من الشىء بدنا كان أو غيره كناية عما خفى. أو من قولهم أحناء الأمور ، أى : مشتبهاتها ، وقرائنها : ما يقترن بها من الأحوال المتعلقة بها والصادرة عنها.
(4) ثم أنشأ الخ الترتيب والتراخى فى قول الامام لا فى الصنع الالهى ، كما لا يخفى والأجواء : جمع جو ، وهو هذا الفضاء العالى بين السماء والأرض. واستفيد من كلامه أن الفضاء مخلوق ، وهو مذهب قوم ، كما استفيد منه أن اللّه خلق فى الفضاء ماء حمله على متن ريح فاستقل عليها حتى صارت مكانا له ، ثم خلق فوق ذلك الماء ريحا أخرى سلطها عليه فموجته تمويجا شديدا حتى ارتفع فخلق منه الأجرام العليا وإلى هذا يذهب قوم من الفلاسفة منهم تالسين الاسكندرى ، يقولون : إن الماء ـ أى : الجوهر السائل ـ أصل كل الأجسام كثيفها من متكاثفه ، ولطيفها من شفائفه. والأرجاء : الجوانب واحدها رجا
(5) السكائك : جمع سكاكة ـ بالضم ـ وهى : الهواء الملاقى عنان السماء وبابها نحو ذوابة وذوائب.
(6) التيار : الموج ، والمتراكم : ما يكون بعضه فوق بعض ، والزخار : الشديد الزخر ـ أى : الامتداد والارتفاع ـ والريح العاصفة الشديدة الهبوب ، كأنها تهلك الناس بشدة هبوبها ، وكذلك الزعزع ، كأنها تزعزع كل ثابت ، وتقصف ـ أى : تحطم كل قائم
 
على متن الرّيح العاصفة ، والزّعزع القاصفة. فأمرها بردّه (1) وسلّطها على شدّه ، وقرنها إلى حدّه. الهواء من تحتها فتيق (2) والماء من فوقها دفيق. ثمّ أنشأ سبحانه ريحا اعتقم مهبّها (3) وأدام مربّها ، وأعصف مجراها ، وأبعد منشأها ، فأمرها بتصفيق الماء الزّخّار (4) وإثارة موج البحار ، فمخضته مخض السّقاء ، وعصفت به عصفها بالفضاء. تردّ أوّله إلى آخره ، وساجيه إلى مائره (5). حتّى عبّ عبابه. ورمى بالزّبد ركامه ، فرفعه فى هواء منفتق
__________________
(1) امرها برده ، أى : منعه من الهبوط ، لأن الماء ثقيل وشأن الثقيل الهوى والسقوط ، وسلطها على شده ، أى : وثاقه ، كأنه سبحانه أوثقه بها أو منعه من الحركة إلى السفل التى هى من لوازم طبعه ، وقرنها إلى حده ، أى : جعلها مكانا له أى : جعل حد الماء المذكور ، وهو سطحه الأسفل ، مماسا لسطح الريح التى تحمله أو أراد من الحد المنع ، أى : جعل من لوازمها ذلك.
(2) الفتيق : المفتوق ، والدفيق : المدفوق.
(3) اعتقم مهبها : جعل هبوبها عقيما ، والريح العقيم التى لا تلقح سحابا ولا شجرا وكذلك كانت هذه ، لأنها أنشئت لتحريك الماء ليس غير ، والمرب مصدر ميمى من «أرب بالمكان» مثل ألب به ، أى : لازمه ، فأدام مربها ، أى : ملازمتها أو أن أدام من أدمت الدلو ملأتها ، والمرب ، بكسر أوله : المكان والمحل.
(4) تصفيقه : تحريكه وتقليبه ، ومخضته : حركته بشدة كما يمخض السقاء بما فيه من اللبن ليستخرج زبده ، والسقاء : جلد السخلة يجذع فيكون وعاء للبن والماء جمعه أسقية وأسقيات وآساق. و «عصفت به الخ» الريح إذا عصفت بالفضاء الذى لا أجسام فيه كانت شديدة لعدم المانع. وهذه الريح عصفت بهذا الماء ذلك العصف الذى يكون لها لو لم يكن مانع.
(5) الساجى : الساكن ، والمائر : الذى يذهب ويجىء ، أو المتحرك مطلقا. وعب
 
وجوّ منفهق (1) فسوّى منه سبع سموات جعل سفلاهنّ موجا مكفوفا (2) وعلياهنّ سقفا محفوظا ، وسمكا مرفوعا ، بغير عمد يدعمها ، ولا دسار ينظمها (3) ثمّ زيّنها بزينة الكواكب ، وضياء الثّواقب (4) وأجرى فيها سراجا مستطيرا (5) وقمرا منيرا : فى فلك دائر ، وسقف سائر ، ورقيم مائر (6) ثمّ فتق ما بين السّموات العلا ، فملأهنّ أطوارا من ملائكته (7) منهم سجود لا يركعون ،
__________________
عبابه : ارتفع علاه. وركامه : ثبجه ، وهضبته ، وما تراكم منه بعضه على بعض
(1) المنفهق : المفتوح الواسع.
(2) المكفوف : الممنوع من السيلان ، ويدعمها : يسندها ويحفظها من السقوط.
(3) الدسار : واحد الدسر ، وهى المسامير ، أو الخيوط تشد بها ألواح السفينة من ليف ونحوه.
(4) الثواقب : المنيرة المشرقة.
(5) مستطيرا : منتشر الضياء ، وهو الشمس.
(6) الرقيم : اسم من أسماء الفلك : سمى به لأنه مرقوم بالكواكب ، ومائر : متحرك ، ويفسر الرقيم باللوح ، وشبه الفلك باللوح لأنه مسطح فيما يبدو للنظر.
(7) جعل الملائكة أربعة أقسام : الأول : أرباب العبادة ، ومنهم الراكع ، والساجد ، والصاف ، والمسبح. وقوله «صافون» أى : قائمون صفوفا. لا يتزايلون أى : لا يتفارقون. والقسم الثانى : الأمناء على وحى اللّه لأنبيائه ، والألسنة الناطقة فى أفواه رسله ، والمختلفون بالأقضية إلى العباد : بهم يقضى اللّه على من شاء بما شاء. والقسم الثالث : حفظة العباد ، كأنهم قوى مودعة فى أبدان البشر ونفوسهم ، يحفظ اللّه الموصولين بها من المهالك والمعاطب ، ولو لا ذلك لكان العطب ألصق بالانسان من السلامة ، ومنهم سدنة الجنان ، جمع سادن : وهو الخادم ، والخادم يحفظ ما عهد إليه وأقيم على خدمته. والقسم الرابع : حملة العرش ، كأنهم القوة العامة التى أفاضها اللّه فى العالم الكلى ، فهى الماسكة له ، الحافظة لكل جزء منه :
 
وركوع لا ينتصبون ، وصافّون لا يتزايلون ، ومسبّحون لا يسأمون. لا يغشاهم نوم العين ، ولا سهو العقول ، ولا فترة الأبدان ، ولا غفلة النّسيان. ومنهم أمناء على وحيه ، وألسنة إلى رسله ، ومختلفون بقضائه وأمره ، ومنهم الحفظة لعباده ، والسّدنة لأبواب جنانه. ومنهم الثّابتة فى الأرضين السّفلى أقدامهم ، والمارقة من السّماء العليا أعناقهم ، والخارجة من الأقطار أركانهم ، والمناسبة لقوائم العرش أكتافهم. ناكسة دونه أبصارهم (1) متلفّعون تحته بأجنحتهم ، مضروبة بينهم وبين من دونهم حجب العزّة ، وأستار القدرة. لا يتوهّمون ربّهم بالتّصوير ، ولا يجرون عليه صفات المصنوعين ، ولا يحدّونه بالأماكن ، ولا يشيرون إليه بالنّظائر
صفة خلق آدم عليه السلام
ثمّ جمع سبحانه من حزن الأرض وسهلها ، وعذبها وسبخها (2) تربة
__________________
مركزه؟؟؟ ، وحدود مسيره فى مداره ، فهى المخترقة له ، النافذة فيه ، الآخذة من أعلاه إلى أسفله ، ومن أسفله إلى أعلاه. وقوله «المارقة من السماء» : المروق الخروج ، وقوله «الخارجة من الأقطار أركانهم» : الأركان الأعضاء والجوارح ، والتمثيل فى الكلام لا يخفى على أهل البصائر.
(1) الضمير فى «دونه» للعرش كالضمير فى «تحته» ، ومتلفعون : من تلفعت بالثوب ، إذا التحفت به.
(2) الحزن ـ بفتح فسكون ـ : الغليظ الخشن ، والسهل ما يخالفه ، والسبخ :
 
سنّها بالماء حتّى خلصت. ولاطها بالبلّة حتّى لزبت (1) فجبل منها صورة ذات أحناء ووصول (2) وأعضاء وفصول : أجمدها حتّى استمسكت وأصلدها حتّى صلصلت (3) لوقت معدود ، وأمد معلوم ، ثمّ نفخ فيها من روحه فمثلت إنسانا ذا أذهان يجيلها (4) ، وفكر يتصرّف بها ، وجوارح يختدمها (5) ،
__________________
ما ملح من الأرض. وأشار باختلاف الأجزاء التى جبل منها الانسان إلى أنه مركب من طباع مختلفة ، وفيه استعداد للخير والشر ، والحسن والقبيح.
(1) سن الماء : صبه. والمراد صب عليها ، أو «سنها» هنا بمعنى ملسها كما قال : ـ 
ثم خاصرتها إلى القبة الخض
 		راء تمشى فى مرمر مسنون
 
وقوله «حتى خلصت» أى : صارت طينة خالصة ، وفى بعض النسخ «حتى خضلت» بتقديم الضاد المعجمة على اللام ، أى : ابتلت ولعلها أظهر : لاطها : خلطها وعجنها ، أو هو من لاط الحوض بالطين : ملطه وطينه به ، والبلة ـ بالفتح ـ من البلل. ولزب ـ ككرم ـ : تداخل بعضه فى بعض وصلب ، ومن باب نصر بمعنى التصق وثبت واشتد.
(2) الأحناء : جمع حنو وهو ـ بالكسر والفتح ـ : كل ما فيه اعوجاج من البدن كعظم الحجاج ، واللحى ، والضلع ، أو هى الجوانب مطلقا. وجبل : أى خلق.
(3) أصلدها : جعلها صلبة ملساء متينة ، وصلصلت : يبست حتى كانت تسمع لها صلصلة إذا هبت عليها رياح ، وذلك هو الصلصال ، واللام فى قوله «لوقت» متعلقة بمحذوف ، كأنه قال : حتى يبست وجفت معدة لوقت معلوم. ويمكن أن تكون متعلقة بجبل ، أى : جبل من الأرض هذه الصورة ولا يزال يحفظها لوقت معدود ينتهى يوم القيامة.
(4) مثل ، ككرم : قام منتصبا. والأذهان : قوى التعقل ، ويجيلها : يحركها فى المعقولات.
(5) يختدمها : يجعلها فى مآربه وأوطاره كالخدم الذين تستعملهم فى خدمتك
 
وأدوات يقلّبها ، ومعرفة يفرق بها بين الحقّ والباطل والأذواق والمشامّ ، والألوان والأجناس ، معجونا بطينة الألوان المختلفة (1) والأشباه المؤتلفة ، والأضداد المتعادية والأخلاط المتباينة ، من الحرّ والبرد ، والبلّة والجمود ، واستأدى اللّه سبحانه الملائكة وديعته لديهم (2) وعهد وصيّته إليهم ، فى الإذعان بالسّجود له ، والخشوع لتكرمته ، فقال سبحانه : «اُسْجُدُوا لِآدَمَ» فسجدوا إلاّ إبليس اعترته الحميّة وغلبت عليه الشّقوة (3) وتعزّز بخلقة النّار واستهون خلق الصّلصال ، فأعطاه اللّه النّظرة استحقاقا للسّخطة ، واستتماما
__________________
فى شؤونك كلها ، والأدوات : جمع أداة ، وهى الآلة ، وتقليبها : تحريكها فى العمل بها فيما خلقت له.
(1) معجونا صفة «إنسانا» ، والألوان المختلفة : الضروب والفنون ، وتلك الألوان هى التى ذكره من الحر والبرد والبلة والجمود.
(2) استأدى الملائكة وديعته : طلب منهم أداءها ، والوديعة هى عهده إليهم بقوله : «إِنِّي خٰالِقٌ بَشَراً مِنْ طِينٍ فَإِذٰا سَوَّيْتُهُ وَنَفَخْتُ فِيهِ مِنْ رُوحِي فَقَعُوا لَهُ سٰاجِدِينَ» ويروى الخنوع بالنون بدل الخشوع وهو بمعنى الخضوع. وقوله «فقال اسجدوا الخ» عطف على استأدى.
(3) الشقوة ـ بكسر الشين وفتحها ـ ما حتم عليه من الشقاء. والشقاء : ضد السعادة ، وهو النصب الدائم والألم الملازم ، وتعززه بخلقة النار : استكباره مقدار نفسه بسبب أنه خلق من جوهر لطيف ومادة أعلى من مادة الصلصال ، والصلصال : الطين الحر خلط بالرمل ، أو الطين ما لم يجعل خزفا. والمراد من الصلصال هنا مادة الأرض التى خلق آدم عليه السلام منها ، وجوهر ما خلق منه الجن ـ وهم من الجواهر اللطيفة ـ أعلى من جوهر ما خلق منه الانسان ، وهو مجبول من عناصر الارض ، والنظرة ـ بفتح فكسر ـ : الانتظار به حيا ، ما دام الانسان عامرا
 
للبليّة ، وإنجازا للعدة ، فقال (إنَّكَ مِنَ اَلْمُنْظَرِينَ إِلىٰ يَوْمِ اَلْوَقْتِ اَلْمَعْلُومِ) ثمّ أسكن سبحانه آدم دارا أرغد فيها عيشه ، وآمن فيها محلّته ، وحذّره إبليس وعداوته ، فاغترّه عدوّه نفاسة عليه بدار المقام ومرافقة الأبرار (1) فباع اليقين بشكّه ، والعزيمة بوهنه ، واستبدل بالجذل وجلا (2) ، وبالاغترار ندما ثمّ بسط اللّه سبحانه له فى توبته ، ولقّاه كلمة رحمته ، ووعده المردّ إلى جنّته ، وأهبطه إلى دار البليّة (3) وتناسل الذّرّيّة (4) ، واصطفى سبحانه من ولده
__________________
للأرض متمتعا بالوجود ، فيكون من الشيطان فى هذا الأمد ما يستحق به سخط اللّه وما تتم به بلية الشقاء عليه ، ويكون اللّه جل شأنه قد أنجز وعده فى قوله : (إنك لمن المنظرين).
(1) اغتر آدم عدوه الشيطان ، أى : انتهز منه غرة فأغواه ، وكان الحامل للشيطان على غواية آدم حسده له على الخلود فى دار المقام ، ومرافقته الأبرار من الملائكة الأطهار.
(2) أدخل الشيطان عليه الشك فى أن ما تناول منه سائغ التناول بعد أن كان فى نهى اللّه له عن تناوله ما يوجب له اليقين بحظره عليه ، وكانت العزيمة فى الوقوف عند ما أمر اللّه فاستبد بها الوهن الذى أفضى إلى المخالفة ، والجذل ـ بالتحريك ـ الفرح ، وقد كان فى راحة الأمن بالاخبات إلى اللّه وامتثال الأمر ، فلما سقط فى المخالفة تبدل ذلك بالوجل والخوف من حلول العقوبة ، وقد ذهبت عنه الغرة ، وانتبه إلى عاقبة ما اقترف ، فاستشعر الندم بعد الاغترار.
(3) أهبطه من مقام مرشده فيه الالهام الالهى الخالص من الشوائب لانسياق قواه إلى مقتضى الفطرة السليمة الأولى ، إلى مقر قد خلط له فيه الخير والشر ، واختط له فيه الطريقان ، ووكل إلى نظره العقلى ، وابتلى بالتمييز بين النجدين. واختيار أى الطريقين ، وهو العناد الذى تكدر به صفو هذه الحياة على الآدميين.
(4) تناسل الذرية من خصائص تلك المنزلة الثانية التى أنزل اللّه فيها آدم ، وهو
 
أنبياء أخذ على الوحى ميثاقهم (1) ، وعلى تبليغ الرّسالة أمانتهم ، لمّا بدّل أكثر خلقه عهد اللّه إليهم (2) فجهلوا حقّه واتّخذوا الأنداد معه (3) واجتالتهم الشّياطين عن معرفته (4) واقتطعتهم عن عبادته ، فبعث فيهم رسله ، وواتر إليهم أنبياءه (5) ليستأدوهم ميثاق فطرته (6) ويذكّروهم منسىّ نعمته ، ويحتجّوا عليهم بالتّبليغ ، ويثيروا لهم دفائن العقول (7) ويروهم الآيات المقدّرة : من سقف فوقهم
__________________
مما ابتلى به الانسان امتحانا لقوته على التربية ، واقتداره على سياسة من يعولهم ، والقيام بحقوقهم ، وإلزامهم بتأدية ما يحق عليهم.
(1) أخذ عليهم الميثاق أن يبلغوا ما أوحى إليهم ، ويكون ما بعده بمنزلة التأكيد له. وأخذ عليهم ألا يشرعوا للناس إلا ما يوحى إليهم.
(2) عهد اللّه إلى الناس هو ما سيأتى يعبر عنه بميثاق الفطرة.
(3) الأنداد : الأمثال ، وأراد المعبودين من دونه سبحانه وتعالى.
(4) اجتالتهم ـ بالجيم ـ صرفتهم عن قصدهم الذى وجهوا إليه بالهداية المغروزة فى فطرهم ، وأصله من الدوران ، كأن الذى يصرفك عن قصدك يصرفك تارة هكذا وأخرى هكذا ، تقول : اجتال فلان فلانا ، واجتاله عن كذا ، واجتاله على كذا ، أى : أداره عليه ، يحسن له فعله ، ويغريه به ، ويزينه له.
(5) واتر إليهم أنبياءه : أرسلهم وبين كل نبى ومن بعده فترة ، لا بمعنى أرسلهم تباعا بعضهم يعقب بعضا.
(6) كأن اللّه تعالى ـ بما أودع فى الانسان من الغرائز والقوى ، وبما أقام له من الشواهد وأدلة الهدى ـ قد أخذ عليه ميثاقا بأن يصرف ما أوتى من ذلك فيما خلق له ، وقد كان يعمل على ذلك الميثاق ولا ينقضه ، لو لا ما اعترضه من وساوس الشهوات ، فبعث إليه النبيين ليطلبوا من الناس أداء ذلك الميثاق ، أى : ليطالبوهم بما تقتضيه فطرتهم ، وما ينبغى أن تسوقهم إليه غرائزهم.
(7) دفائن العقول : أنوار العرفان التى تكشف للانسان أسرار الكائنات
 
مرفوع ، ومهاد تحتهم موضوع ، ومعايش تحييهم وآجال تفنيهم ، وأوصاب تهرمهم (1) وأحداث تتابع عليهم ، ولم يخل سبحانه خلقه من نبىّ مرسل ، أو كتاب منزل ، أو حجّة لازمة ، أو محجّة قائمة (2) : رسل لا تقصّر بهم قلّة عددهم ، ولا كثرة المكذّبين لهم : من سابق سمّى له من بعده ، أو غابر عرّفه من قبله (3) : على ذلك نسلت القرون (4) ، ومضت الدّهور ، وسلفت الآباء وخلفت الأبناء ، إلى أن بعث اللّه سبحانه محمّدا رسول اللّه صلّى اللّه عليه وسلّم لإنجاز عدته (5) وتمام نبوّته ، مأخوذا على النّبيّين ميثاقه ، مشهورة سماته (6)
__________________
وترتفع به إلى الايقان بصانع الموجودات ، وقد تحجب هذه الأنوار غيوم من الأوهام ، وحجب من الخيال ، فيأتى النبيون لاثارة تلك المعارف الكامنة ، وإبراز تلك الأسرار الباطنة. (3 ـ ن ـ ج ـ (1)
(1) السقف المرفوع : السماء ، والمهاد الموضوع : الأرض ، والأوصاب : المتاعب
(2) المحجة : الطريق القويمة الواضحة
(3) من سابق : بيان للرسل ، وكثير من الأنبياء السابقين سميت لهم الأنبياء الذين يأتون بعدهم فبشروا بهم كما ترى ذلك فى التوراة ، وفى القرآن الكريم أن عيسى عليه السلام بشر بخاتم الرسل صلى اللّه عليه وسلم والغابر : الذى يأتى بعد أن يبشر به السابق ، جاء معروفا بتعريف من قبله.
(4) نسلت ـ بالبناء للمجهول ـ ولدت ، وبالبناء للفاعل : مضت متتابعة.
(5) الضمير فى «عدته» للّه تعالى ، لأن اللّه وعد بارسال محمد صلى اللّه عليه وسلم على لسان أنبيائه السابقين ، وكذلك الضمير فى «نبوته» لأن اللّه تعالى أنبأبه وأنه سيبعث وحيا لأنبيائه ، فهذا الخبر الغيبى قبل حصوله يسمى نبوة : ولما كان اللّه هو المخبر به أضيفت النبوة إليه ، هكذا نسب للامام ، ولكن الأظهر أن الضمير فى «نبوته» عائد إلى النبى صلى اللّه عليه وسلم
(6) سماته : علاماته التى ذكرت فى كتب الأنبياء السابقين الذين بشروا به
 
كريما ميلاده. وأهل الأرض يومئذ ملل متفرّقة ، وأهواء منتشرة وطوائف متشتّتة ، بين مشبّه للّه بخلقه أو ملحد فى اسمه ، أو مشير إلى غيره (1) ، فهداهم به من الضّلالة ، وأنقذهم بمكانه من الجهالة. ثمّ اختار سبحانه لمحمّد صلّى اللّه عليه وسلّم لقاءه ، ورضى له ما عنده ، وأكرمه عن دار الدّنيا ، ورغب به عن مقارنة البلوى ، فقبضه إليه كريما صلّى اللّه عليه وآله وخلّف فيكم ما خلّفت الأنبياء فى أممها ـ إذ لم يتركوهم هملا : بغير طريق واضح ، ولا علم قائم (2) كتاب ربّكم فيكم : مبيّنا حلاله وحرامه (3) وفرائضه وفضائله ، وناسخه 
__________________
(1) الملحد فى اسم اللّه : الذى يميل به عن حقيقة مسماه ، فيعتقد فى اللّه صفات يجب تنزيهه عنها ، والمشير إلى غيره : الذى يشرك معه فى التصرف إلها آخر فيعبده ويستعينه
(2) العلم ـ بفتحتين ـ ما يوضع ليهتدى به ، أى : أن الأنبياء لم يهملوا أممهم مما يرشدهم بعد موت أنبيائهم ، وقد كان من محمد صلى اللّه عليه وسلم مثل ما كان منهم ، فانه خلف فى أمته كتاب اللّه تعالى حاويا لجميع ما يحتاجون إليه فى دينهم.
(3) حلاله كالأكل من الطيبات ، وحرامه كأكل أموال الناس بالباطل ، وفرائضه كالزكاة أخت الصلاة ، وفضائله كنوافل الصدقات التى يعظم الأجر فيها ولا حرج على من لا يؤديها ، وناسخه : ما جاء قاضيا بمحو ما كان عليه الضالون من العقائد ، أو إزالة السابق من الأحكام لحكمة إلهية اقتضت تغييره وإن خفيت على بعض العقول كقوله تعالى : «قُلْ لاٰ أَجِدُ فِي مٰا أُوحِيَ إِلَيَّ مُحَرَّماً عَلىٰ طٰاعِمٍ يَطْعَمُهُ» الآية ، ومنسوخه ما كان حكاية عن تلك الأحكام كقوله : «وَعَلَى اَلَّذِينَ هٰادُوا حَرَّمْنٰا كُلَّ ذِي ظُفُرٍ» الآية ، ورخصه كقوله : «فَمَنِ اُضْطُرَّ فِي مَخْمَصَةٍ» وعزائمه كقوله : «وَلاٰ تَأْكُلُوا مِمّٰا لَمْ يُذْكَرِ اِسْمُ اَللّٰهِ عَلَيْهِ» وخاصه كقوله : «وَاِمْرَأَةً مُؤْمِنَةً إِنْ وَهَبَتْ نَفْسَهٰا» الآية ، وكقوله «يٰا أَيُّهَا اَلنَّبِيُّ لِمَ تُحَرِّمُ مٰا أَحَلَّ اَللّٰهُ لَكَ» وعامه ،
 
ومنسوخه ، ورخصه وعزائمه ، وخاصّه وعامّه ، وعبره وأمثاله ، ومرسله ومحدوده ، ومحكمه ومتشابهه ، مفسّرا مجمله ، ومبيّنا غوامضه ، بين مأخوذ ميثاق فى علمه ، وموسّع على العباد فى جهله ، وبين مثبت فى الكتاب فرضه ومعلوم فى السّنّة نسخه ، وواجب فى السّنّة أخذه ، ومرخّص فى الكتاب تركه ، وبين واجب بوقته ، وزائل فى مستقبله ، ومباين بين محارمه (1) : من كبير
__________________
كقوله : «يٰا أَيُّهَا اَلنَّبِيُّ إِذٰا طَلَّقْتُمُ اَلنِّسٰاءَ فَطَلِّقُوهُنَّ لِعِدَّتِهِنَّ». والعبر كالآيات التى تخبر عما أصاب الأمم الماضية من النكال ، وعما نزل بهم من العذاب لما حادوا عن الحق وركبوا طرق الظلم والعدوان ، والأمثال كقوله «ضَرَبَ اَللّٰهُ مَثَلاً عَبْداً مَمْلُوكاً» ، الآية ، وقوله : «كَمَثَلِ اَلَّذِي اِسْتَوْقَدَ نٰاراً» ، وأشباه ذلك كثيرة ، والمرسل : المطلق ، والمحدود : المقيد ، والمحكم كآيات الأحكام والأخبار الصريحة فى معانيها ، والمتشابه كقوله : «يَدُ اَللّٰهِ فَوْقَ أَيْدِيهِمْ» ، والموسع على العباد فى جهله كالحروف المفتتحة بها السور نحو الم والر ، والمثبت فى الكتاب فرضه مع بيان السنة لنسخه نحو قوله تعالى : «فَأَمْسِكُوهُنَّ فِي اَلْبُيُوتِ حَتّٰى يَتَوَفّٰاهُنَّ اَلْمَوْتُ» فانه نسخ بما سنه عليه السلام من رجم الزانى المحصن. وكالصلاة ، فانها فرضت على الذين من قبلنا ، غير أن السنة بينت لنا الهيئة التى اختصنا اللّه بها ، وكلفنا أن نؤدى الصلاة عليها ، فالفرض فى الكتاب ، وتبيين نسخه لما كان قبله فى السنة ، والمرخص فى الكتاب تركه ما لم يكن منصوصا على عينه ، بل ذكر فى الكتاب ما يشتمله وغيره كقوله : «فَاقْرَؤُا مٰا تَيَسَّرَ مِنْهُ» ، وقد عينته السنة بسورة مخصوصة فى كل ركعة فوجب الأخذ بما عينته السنة ، ولو بقينا عند مجمل الكتاب لكان لنا أن نقرأ فى الصلاة غير الفاتحة جوازا لا مؤاخذة معه ، والواجب بوقته الزائل فى مستقبله كصوم رمضان يجب فى جزء من السنة ولا يجب فى غيره
(1) و «مباين بين محارمه» ، بالرفع على أنه خبر لمبتدأ محذوف وليس مجرورا بالعطف على الأقسام التى سبق تفصيلها ، أى : والكتاب قد فرق بين المحارم التى حظرها : فمنها كبير أوعد عليه نيرانه كالزنا وقتل النفس ، ومنها
 
أوعد عليه نيرانه ، أو صغير أرصد له غفرانه. وبين مقبول فى أدناه ، موسّع فى أقصاه (1)
منها فى ذكر الحج
وفرض عليكم حجّ بيته الحرام ، الّذى جعله قبلة للأنام ، يردونه ورود الأنعام ، ويألهون إليه ولوه الحمام (2) جعله سبحانه علامة لتواضعهم لعظمته ، وإذعانهم لعزّته ، واحتار من خلقه سمّاعا أجابوا إليه دعوته ، وصدّقوا كلمته ، ووقفوا مواقف أنبيائه ، وتشبّهوا بملائكته المطيفين بعرشه : يحرزون الأرباح فى متجر عبادته ، ويتبادرون عند موعد مغفرته ، جعله سبحانه وتعالى للإسلام علما ، وللعائذين حرما ، فرض حجّه ، وأوجب حقّه ، وكتب عليكم وفادته (3) فقال سبحانه : «وَلِلّٰهِ عَلَى اَلنّٰاسِ حِجُّ اَلْبَيْتِ مَنِ اِسْتَطٰاعَ إِلَيْهِ سَبِيلاً وَمَنْ كَفَرَ فَإِنَّ اَللّٰهَ غَنِيٌّ عَنِ اَلْعٰالَمِينَ».
__________________
صغيرا رصد له غفرانه كالنظرة بشهوة ونحوها ، ومنهم من رواه «مباينا» منصوبا على أنه صفة من صفات الكتاب
(1) رجوع إلى تقسيم الكتاب ، والمقبول فى أدناه الموسع فى أقصاه كما فى كفارة اليمين يقبل فيها إطعام عشرة مساكين وموسع فى كسوتهم وعتق الرقبة
(2) يألهون إليه : أى يفزعون إليه أو يلوذون به ، ويعكفون عليه ، وروى «يولهون» بفتح اللام ، من الوله ، وهو شدة الوجد حتى يكاد العقل يذهب.
(3) الوفادة : الزيارة
 
",
        "category": "sermons",
        "source": "الخطبة 1"
      },
      {
        "id": 2,
        "title": "رسالة إلى مالك الأشتر",
        "content": "هذا ما أمر به عبد الله علي أمير المؤمنين مالك بن الحارث الأشتر في عهده إليه حين ولاه مصر: جباية خراجها، وجهاد عدوها، واستصلاح أهلها، وعمارة بلادها.",
        "category": "letters",
        "source": "الرسالة 53"
      },
      {
        "id": 3,
        "title": "من حكم الإمام علي",
        "content": "قيمة كل امرئ ما يحسنه، والعلم مقرون بالعمل، فمن علم عمل، والعلم يهتف بالعمل، فإن أجابه وإلا ارتحل.",
        "category": "wisdom",
        "source": "الحكمة 81"
      }
    ];
    
    console.log('تم تحميل بيانات تجريبية');
  }

  searchContent() {
    console.log('بحث عن:', this.currentSearch);
    
    if (this.elements.nahjSearch) {
      this.currentSearch = this.elements.nahjSearch.value.trim();
      this.currentPage = 1;
      this.renderContent();
    }
  }

  getFilteredData() {
    let filteredData = this.data;

    // التصفية حسب الفئة
    if (this.currentCategory !== 'all') {
      filteredData = filteredData.filter(item => 
        item.category === this.currentCategory
      );
    }

    // البحث
    if (this.currentSearch) {
      const searchTerm = this.currentSearch.toLowerCase();
      filteredData = filteredData.filter(item => 
        (item.title && item.title.toLowerCase().includes(searchTerm)) ||
        (item.content && item.content.toLowerCase().includes(searchTerm))
      );
    }

    return filteredData;
  }

  renderContent() {
    console.log('عرض المحتوى...');
    
    if (!this.elements.nahjContent) {
      console.error('عنصر nahj-content غير موجود');
      return;
    }

    const filteredData = this.getFilteredData();
    const startIndex = (this.currentPage - 1) * this.itemsPerPage;
    const endIndex = startIndex + this.itemsPerPage;
    const pageData = filteredData.slice(startIndex, endIndex);
    const totalPages = Math.ceil(filteredData.length / this.itemsPerPage);

    console.log(`عرض ${pageData.length} عنصر من أصل ${filteredData.length}`);
    
    // عرض المحتوى
    if (pageData.length === 0) {
      this.elements.nahjContent.innerHTML = `
        <div class="text-center py-5">
          <i class="bi bi-search text-muted" style="font-size: 3rem;"></i>
          <h5 class="mt-3">لا توجد نتائج</h5>
          <p class="text-muted">لم يتم العثور على محتوى يتطاسب مع بحثك</p>
        </div>
      `;
    } else {
      this.elements.nahjContent.innerHTML = pageData.map(item => `
        <div class="nahj-item">
          <div class="nahj-title">${this.escapeHtml(item.title || 'بدون عنوان')}</div>
          <div class="nahj-text">${this.escapeHtml(item.content || 'لا يوجد محتوى')}</div>
          <div class="nahj-meta">
            <span class="nahj-category">${this.getCategoryName(item.category)}</span>
            <span>${this.escapeHtml(item.source || '')}</span>
          </div>
        </div>
      `).join('');
    }

    // عرض الترقيم
    this.renderPagination(totalPages);
  }

  escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  renderPagination(totalPages) {
    if (!this.elements.nahjPagination) return;
    
    this.elements.nahjPagination.innerHTML = '';

    if (totalPages <= 1) return;

    // زر السابق
    const prevLi = document.createElement('li');
    prevLi.className = `page-item ${this.currentPage === 1 ? 'disabled' : ''}`;
    prevLi.innerHTML = `
      <a class="page-link" href="#" data-page="${this.currentPage - 1}">
        <i class="bi bi-chevron-right"></i>
      </a>
    `;
    this.elements.nahjPagination.appendChild(prevLi);

    // أرقام الصفحات
    const maxVisible = 5;
    let startPage = Math.max(1, this.currentPage - Math.floor(maxVisible / 2));
    let endPage = Math.min(totalPages, startPage + maxVisible - 1);

    if (endPage - startPage + 1 < maxVisible) {
      startPage = Math.max(1, endPage - maxVisible + 1);
    }

    for (let i = startPage; i <= endPage; i++) {
      const li = document.createElement('li');
      li.className = `page-item ${i === this.currentPage ? 'active' : ''}`;
      li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
      this.elements.nahjPagination.appendChild(li);
    }

    // زر التالي
    const nextLi = document.createElement('li');
    nextLi.className = `page-item ${this.currentPage === totalPages ? 'disabled' : ''}`;
    nextLi.innerHTML = `
      <a class="page-link" href="#" data-page="${this.currentPage + 1}">
        <i class="bi bi-chevron-left"></i>
      </a>
    `;
    this.elements.nahjPagination.appendChild(nextLi);

    // إضافة مستمعي الأحداث
    this.elements.nahjPagination.querySelectorAll('.page-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = parseInt(link.dataset.page);
        if (page && page !== this.currentPage) {
          this.currentPage = page;
          this.renderContent();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      });
    });
  }

  getCategoryName(category) {
    const categories = {
      'sermons': 'خطبة',
      'letters': 'رسالة',
      'wisdom': 'حكمة'
    };
    return categories[category] || category;
  }

  showNahjPage() {
    console.log('عرض صفحة نهج البلاغة...');
    
    if (!this.pageLoaded) {
      console.log('الصفحة غير محملة، جاري التحميل...');
      this.init().then(() => {
        this.switchToNahjPage();
      });
    } else {
      this.switchToNahjPage();
    }
  }

  switchToNahjPage() {
    // إخفاء كل الصفحات
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    // إظهار صفحة نهج البلاغة
    if (this.elements.nahjPage) {
      this.elements.nahjPage.classList.add('active');
      console.log('تم عرض صفحة نهج البلاغة');
    } else {
      console.error('صفحة نهج البلاغة غير موجودة');
    }
  }

  showHomePage() {
    console.log('العودة للصفحة الرئيسية...');
    
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    const homePage = document.getElementById('home-page');
    if (homePage) {
      homePage.classList.add('active');
    }
  }
}

// === التعديل الرئيسي هنا ===
// استخدم `let` مرة واحدة فقط
if (typeof window.nahjAlBalaghaInstance === 'undefined') {
  // إنشاء المتغير فقط إذا لم يكن موجوداً
  let nahjAlBalaghaInstance;
  
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM محمّل، جاري تهيئة نهج البلاغة...');
    
    // إنشاء كائن نهج البلاغة
    nahjAlBalaghaInstance = new NahjAlBalagha();
    
    // إضافة حدث لزر نهج البلاغة في الهيدر
    const nahjButton = document.getElementById('nahj-button');
    if (nahjButton) {
      nahjButton.addEventListener('click', () => {
        console.log('تم النقر على زر نهج البلاغة');
        if (nahjAlBalaghaInstance) {
          nahjAlBalaghaInstance.showNahjPage();
        }
      });
      console.log('تمت إضافة حدث لزر نهج البلاغة');
    } else {
      console.warn('زر نهج البلاغة غير موجود في الهيدر');
    }
    
    // جعل الكائن متاحاً عالمياً
    window.nahjAlBalaghaInstance = nahjAlBalaghaInstance;
  });
  
  // جعل الكلاس متاحاً عالمياً
  window.NahjAlBalagha = NahjAlBalagha;
}
